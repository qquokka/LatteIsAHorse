<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.like">

	<select id="getUsersLikeMenuList"
		resultType="com.latte.dto.UsersLikeMenu">
		select * from userslikemenu
	</select>

	<!-- 메뉴 고유 id 에 대한 카운트 값을 돌려줌. 고로 업데이트시 리스폰스 해줄 예정 -->
	<select id="getUsersLikeMenuCountBymenuId"
		parameterType="java.lang.Integer"
		resultType="com.latte.dto.UsersLikeMenu">
		select m.mid menu_id, count(ulm.like_count) like_count from
		menu m join
		userslikemenu ulm on m.mid=ulm.menu_id and m.mid = #{mid}
		group by
		menu_id
	</select>

	<!-- cafecontroller에서만 사용!!!!!! detail에사용되며 완벽작동함. 에러시 로그인 세션이 풀린거 체크!... -->
	<select id="getUsersLikeMenuByCafeIdNUserId"
		parameterType="com.latte.dto.UsersLikeMenu"
		resultType="com.latte.dto.UsersLikeMenu">
		select m.mid menu_id, count(ulm.like_count) like_count from
		menu m join
		userslikemenu ulm on m.mid=ulm.menu_id AND m.cafe_id =
		#{cafe_id} and
		ulm.users_id =#{users_id} group by menu_id
	</select>

	<insert id="addUsersLikeMenu"
		parameterType="com.latte.dto.UsersLikeMenu">
		insert into userslikemenu
		(users_id, menu_id) values
		(#{users_id},#{menu_id})
	</insert>

	<delete id="deleteLikeByUserIdNMenuId"
		parameterType="com.latte.dto.UsersLikeMenu">
		delete from userslikemenu where
		users_id=#{users_id} and
		menu_id=#{menu_id}
	</delete>

</mapper>