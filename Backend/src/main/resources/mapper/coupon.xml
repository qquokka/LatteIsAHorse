<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.coupon">

	<!-- DB 에 저장된 모든 쿠폰을 반환[관리자용] -->

	<select id="getCouponList" resultType="com.latte.dto.Coupon">
		select
		id,
		users_id,
		cafe_id,
		count
		from coupon
	</select>

	<!-- 카페아이디로 등록된 쿠폰을 보여줍니다. -->
	<select id="getCouponListByCafeId" parameterType="_long"
		resultType="com.latte.dto.Coupon">
		select id, users_id,
		cafe_id, count
		from coupon where
		cafe_id=#{cafe_id}
	</select>

	<!-- Create -->
	<insert id="addCoupon" parameterType="com.latte.dto.Coupon">
		insert into coupon
		(users_id,
		cafe_id, count)
		values(
		#{users_id},
		#{cafe_id},
		#{count}
		)
	</insert>

	<!-- Read -->
	<select id="getCouponByUserId" parameterType="_long"
		resultType="com.latte.dto.Coupon">
		select id, users_id, cafe_id, count from coupon where
		users_id =#{users_id}
	</select>

	<!-- Update -->
	<update id="updateCoupon" parameterType="com.latte.dto.Coupon">
		update coupon set
		count = (#{count} + count)
		where
		users_id = #{users_id}
		and cafe_id = #{cafe_id}
	</update>
	
	<!-- Delete -->
	<delete id="deleteCouponByUserId" parameterType="_long">
		delete from
		coupon where
		id=#{id}
	</delete>
	
	<!-- Is Exist in DB -->
	<select id="isExist" parameterType="coupon">
		select count(*) from coupon 
		where users_id = #{users_id}
		and cafe_id = #{cafe_id}
	</select>
	
	<!-- plus coupon count -->
	<update id="useCoupon" parameterType="coupon">
		update coupon set
		count = (count - #{count})
		where
		users_id = #{users_id}
		and cafe_id = #{cafe_id}
	</update>
	
	<select id="getCurrentCouponCount" parameterType="coupon" resultType="java.lang.Integer">
		select count from coupon where
		users_id = #{users_id}
		and cafe_id = #{cafe_id}
	</select>
</mapper>